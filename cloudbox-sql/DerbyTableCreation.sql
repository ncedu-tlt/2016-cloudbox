drop TABLE CB_FILE;
drop TABLE CB_TEMPLINK ;
drop TABLE CB_ROLE;
drop TABLE CB_USER;
drop TABLE CB_USERROLE;
drop TABLE CB_USERFILE ;
drop TABLE CB_AUTHHASH;

CREATE TABLE CB_FILE
  (
    FILEUSERID INTEGER 	           NOT NULL,
    FILEID     INTEGER 	           NOT NULL ,
    FILENAME   VARCHAR (500) NOT NULL ,
    FILEEXT    VARCHAR (15) NOT NULL ,
    FILEDATE   TIMESTAMP           NOT NULL ,
    FILEHASH   VARCHAR (200) NOT NULL,
    CONSTRAINT PK_FILE PRIMARY KEY ( FILEID )
  ) ;


CREATE TABLE CB_TEMPLINK
  (
    TLINKID     INTEGER NOT NULL ,
    TLINKFILEID INTEGER NOT NULL ,
    TLINKPATH   VARCHAR (100) ,
    TLINKEXPIRE DATE,
    CONSTRAINT PK_TEMPLINK PRIMARY KEY ( TLINKID )
  ) ;


CREATE TABLE CB_ROLE
  ( 
    ROLEID    INTEGER NOT NULL , 
    ROLELABEL VARCHAR (20),
    CONSTRAINT PK_ROLE PRIMARY KEY ( ROLEID )
  ) ;


CREATE TABLE CB_USER
  (
    USERID       INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
    USERMAIL     VARCHAR (70 ) NOT NULL ,
    USERPASSHASH VARCHAR (150) NOT NULL ,
    USERSALT     VARCHAR (200) NOT NULL ,
    USERNAME 	 VARCHAR (70) NOT NULL ,
    USERNOTES    VARCHAR (100) ,
    USERPIC      VARCHAR (100) ,
    CONSTRAINT PK_USER PRIMARY KEY ( USERID )
  ) ;

CREATE TABLE CB_USERROLE
  (
    UR_USERID INTEGER NOT NULL ,
    UR_ROLEID INTEGER NOT NULL,
    CONSTRAINT PK_USERROLE PRIMARY KEY ( UR_USERID, UR_ROLEID )
  ) ;

CREATE TABLE CB_USERFILE
  (
    UF_USERID INTEGER NOT NULL ,
    UF_FILEID INTEGER NOT NULL ,
    UF_DEL	  DATE ,
    CONSTRAINT PK_USERFILE PRIMARY KEY ( UF_USERID, UF_FILEID )
  ) ;

CREATE TABLE CB_AUTHHASH
  (
    AH_USERID INTEGER            NOT NULL ,
    AH_HASH   VARCHAR (70 ) NOT NULL ,
    AH_EXPIRE DATE ,
    CONSTRAINT PK_AUTHHASH PRIMARY KEY ( AH_USERID, AH_HASH )
  ) ;


ALTER TABLE CB_FILE     ADD CONSTRAINT FK_FILE_USERID_USER     FOREIGN KEY ( FILEUSERID )  REFERENCES CB_USER ( USERID ) ;
ALTER TABLE CB_TEMPLINK ADD CONSTRAINT FK_TEMPLINK_FILEID_FILE FOREIGN KEY ( TLINKFILEID ) REFERENCES CB_FILE ( FILEID ) ;
ALTER TABLE CB_USERROLE ADD CONSTRAINT FK_USERROLE_USERID_USER FOREIGN KEY ( UR_USERID )   REFERENCES CB_USER ( USERID ) ;
ALTER TABLE CB_USERROLE ADD CONSTRAINT FK_USERROLE_ROLEID_ROLE FOREIGN KEY ( UR_ROLEID )   REFERENCES CB_ROLE ( ROLEID ) ;
ALTER TABLE CB_USERFILE ADD CONSTRAINT FK_USERFILE_USERID_USER FOREIGN KEY ( UF_USERID )   REFERENCES CB_USER ( USERID ) ;
ALTER TABLE CB_USERFILE ADD CONSTRAINT FK_USERFILE_FILEID_FILE FOREIGN KEY ( UF_FILEID )   REFERENCES CB_FILE ( FILEID ) ; 
ALTER TABLE CB_AUTHHASH ADD CONSTRAINT FK_AUTHHASH_USERID_USER FOREIGN KEY ( AH_USERID )   REFERENCES CB_USER ( USERID ) ; 